<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Demo â€“ Comments with EmailJS</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    const EMAILJS_PUBLIC_KEY  = "ADVU4PI9eUMlMMsD2";
    const EMAILJS_SERVICE_ID  = "service_glsv9dm";
    const EMAILJS_TEMPLATE_ID = "template_as29om9";

    document.addEventListener('DOMContentLoaded', () => {
      if (window.emailjs) {
        emailjs.init(EMAILJS_PUBLIC_KEY);
      } else {
        console.error("EmailJS failed to load");
      }
      renderComments();
    });

    function addComment(){
      const input = document.getElementById('commentInput');
      const txt = input.value.trim();
      if(!txt) return;

      const comments = JSON.parse(localStorage.getItem('comments')||'[]');
      const item = {t: Date.now(), text: txt, page: location.href};
      comments.push(item);
      localStorage.setItem('comments', JSON.stringify(comments));
      input.value = '';
      renderComments();

      if (window.emailjs) {
        const params = {
          comment_text: item.text,
          page_url: item.page,
          time_iso: new Date(item.t).toISOString()
        };
        emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params)
          .then(()=>console.log('Email sent'))
          .catch(err=>console.warn('Email send failed', err));
      }
    }

    function renderComments(){
      const list = document.getElementById('commentList');
      list.innerHTML = '';
      const comments = JSON.parse(localStorage.getItem('comments')||'[]');
      comments.slice().reverse().forEach(c => {
        const div = document.createElement('div');
        div.className = 'comment';
        const d = new Date(c.t);
        div.innerHTML = `<strong>${d.toLocaleString()}</strong><br>${escapeHtml(c.text)}`;
        list.appendChild(div);
      });
    }

    function escapeHtml(s){
      return s.replace(/[&<>\"]/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[m]));
    }
  </script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .comment { background:#f0f0f0; margin:5px 0; padding:8px; border-radius:4px; }
  </style>
</head>
<body>
  <h1>Comments</h1>
  <textarea id="commentInput" placeholder="Leave a comment..." rows="3" style="width:100%;max-width:500px;"></textarea><br>
  <button onclick="addComment()">Submit</button>
  <div id="commentList" style="margin-top:20px;"></div>
</body>
</html>
